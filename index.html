<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>LaserOstop España - Reserve su cita</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<style>
    .material-icons {
      vertical-align: middle;
    }

    /* Map container */
    #spain-map-container {
      position: relative;
      width: 100%;
      height: 600px;
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }

    #spain-map {
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    /* Custom marker styles */
    .custom-marker {
      background-color: #22A9AF;
      width: 30px;
      height: 30px;
      border-radius: 50% 50% 50% 0;
      transform: rotate(-45deg);
      border: 3px solid white;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }

    .custom-marker::after {
      content: '';
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: white;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }

    /* Leaflet popup customization */
    .leaflet-popup-content-wrapper {
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .leaflet-popup-content {
      margin: 16px;
      font-family: 'Poppins', sans-serif;
    }

    .leaflet-popup-content h3 {
      color: #22A9AF;
      font-weight: 600;
      margin-bottom: 8px;
    }

    /* Reviews Carousel Animations */
    @keyframes scroll-left {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(-50%);
      }
    }

    @keyframes scroll-right {
      0% {
        transform: translateX(-50%);
      }
      100% {
        transform: translateX(0);
      }
    }

    .carousel-track {
      display: flex;
      gap: 1.5rem;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
    }

    .carousel-row-1 .carousel-track {
      animation: scroll-left 40s linear infinite;
    }

    .carousel-row-2 .carousel-track {
      animation: scroll-right 40s linear infinite;
    }

    .carousel-container:hover .carousel-track {
      animation-play-state: paused;
    }

    .review-card-carousel {
      flex: 0 0 350px;
      min-width: 350px;
    }
  </style>
<script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#22A9AF",
            "background-light": "#FFFFFF",
            "background-dark": "#121212",
            "text-light": "#374151",
            "text-dark": "#E5E7EB",
            "border-light": "#E5E7EB",
            "border-dark": "#374151",
          },
          fontFamily: {
            display: ["Poppins", "sans-serif"],
          },
          borderRadius: {
            DEFAULT: "0.5rem",
          },
        },
      },
    };
  </script>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-text-light dark:text-text-dark">
<div class="min-h-screen flex flex-col">

<!-- Logo Header -->
<header class="bg-white dark:bg-gray-900 shadow-sm">
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
<div class="flex justify-center">
<img src="assets/logolaserostop-bleu.svg" alt="LaserOstop España" class="h-16 sm:h-20 w-auto"/>
</div>
</div>
</header>

<main class="flex-grow">
<section class="relative py-20 sm:py-32 bg-cover bg-center" style="background-image: url('assets/cigarettes.png');">
<div class="absolute inset-0 bg-white dark:bg-black opacity-60"></div>
<div class="container mx-auto px-4 sm:px-6 lg:px-8 relative text-center">
<h1 class="text-4xl sm:text-5xl md:text-6xl font-bold text-gray-800 dark:text-white leading-tight">Reserve su cita hoy mismo <br class="hidden sm:block"/> para dejar de fumar suavemente</h1>
<p class="mt-6 text-lg sm:text-xl text-gray-700 dark:text-gray-200 max-w-3xl mx-auto">Únase a miles de personas que han recuperado su libertad gracias a nuestro método innovador.</p>
</div>
</section>

<section class="bg-gray-50 dark:bg-gray-800 py-6">
<div class="container mx-auto px-4 sm:px-6 lg:px-8">
<div class="flex flex-wrap justify-center items-center gap-x-8 gap-y-4 text-center">
<div class="flex items-center text-primary">
<span class="material-icons mr-2">check_circle</span>
<span class="font-medium text-text-light dark:text-text-dark">Indoloro y sin peligro</span>
</div>
<div class="flex items-center text-primary">
<span class="material-icons mr-2">check_circle</span>
<span class="font-medium text-text-light dark:text-text-dark">Sin aumento de peso</span>
</div>
<div class="flex items-center text-primary">
<span class="material-icons mr-2">check_circle</span>
<span class="font-medium text-text-light dark:text-text-dark">Sin efectos secundarios</span>
</div>
</div>
</div>
</section>

<section class="py-16 sm:py-24" id="booking">
<div class="container mx-auto px-4 sm:px-6 lg:px-8">
<div class="max-w-4xl mx-auto bg-background-light dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden">
<div class="p-8 sm:p-12">
<div id="booking-form">
<div class="mb-8" id="step-1">
<h2 class="text-2xl font-semibold mb-4 text-text-light dark:text-text-dark"><span class="text-primary mr-3">1.</span>Elija su centro</h2>
<div class="relative">
<span class="material-icons absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">place</span>
<select id="center-select" class="w-full pl-12 pr-4 py-3 border border-border-light dark:border-border-dark rounded-full bg-transparent focus:ring-primary focus:border-primary transition">
<option value="">Seleccione un centro...</option>
<option value="alicante">LaserOstop Alicante</option>
<option value="barcelona-gracia">LaserOstop Barcelona Gràcia</option>
<option value="barcelona-sants">LaserOstop Barcelona Sants</option>
<option value="madrid-atocha">LaserOstop Madrid Atocha</option>
<option value="madrid-chamartin">LaserOstop Madrid Chamartín</option>
<option value="majadahonda">LaserOstop Majadahonda</option>
<option value="san-sebastian">LaserOstop San Sebastián de los Reyes</option>
<option value="terrassa">LaserOstop Terrassa</option>
<option value="torrejon">LaserOstop Torrejón de Ardoz</option>
<option value="valencia">LaserOstop Valencia</option>
<option value="sevilla">LaserOstop Sevilla</option>
</select>
</div>
</div>
<div class="mb-8 hidden" id="step-1b">
<h2 class="text-2xl font-semibold mb-4 text-text-light dark:text-text-dark"><span class="text-primary mr-3">2.</span>Tipo de sesión</h2>
<div class="relative">
<span class="material-icons absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">healing</span>
<select id="booking-type-select" class="w-full pl-12 pr-4 py-3 border border-border-light dark:border-border-dark rounded-full bg-transparent focus:ring-primary focus:border-primary transition">
<option value="">Seleccione el tipo de sesión...</option>
</select>
</div>
<!-- Info box for selected type -->
<div id="booking-type-info" class="hidden mt-4 p-4 bg-primary/10 border border-primary/30 rounded-lg">
<div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-sm">
<div class="flex items-center">
<span class="material-icons text-primary mr-2 text-lg">schedule</span>
<div>
<p class="text-gray-500 dark:text-gray-400 text-xs">Duración</p>
<p id="type-duration" class="font-semibold text-text-light dark:text-text-dark">-</p>
</div>
</div>
<div class="flex items-center">
<span class="material-icons text-primary mr-2 text-lg">euro</span>
<div>
<p class="text-gray-500 dark:text-gray-400 text-xs">Precio</p>
<p id="type-price" class="font-semibold text-text-light dark:text-text-dark">-</p>
</div>
</div>
<div class="flex items-center">
<span class="material-icons text-primary mr-2 text-lg">info</span>
<div>
<p class="text-gray-500 dark:text-gray-400 text-xs">Descripción</p>
<p id="type-description" class="font-semibold text-text-light dark:text-text-dark text-xs">-</p>
</div>
</div>
</div>
</div>
</div>
<div class="mb-8 hidden" id="step-2">
<h2 class="text-2xl font-semibold mb-4 text-text-light dark:text-text-dark"><span class="text-primary mr-3">3.</span>Elija una fecha y una hora</h2>
<div class="bg-gray-50 dark:bg-gray-700/50 p-6 rounded-lg">
<div class="flex justify-between items-center mb-4">
<button id="prev-month" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition"><span class="material-icons">chevron_left</span></button>
<h3 id="current-month" class="text-lg font-semibold"></h3>
<button id="next-month" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition"><span class="material-icons">chevron_right</span></button>
</div>
<div class="grid grid-cols-7 gap-2 text-center mb-2">
<div class="text-gray-500 text-sm font-medium">Lu</div>
<div class="text-gray-500 text-sm font-medium">Ma</div>
<div class="text-gray-500 text-sm font-medium">Mi</div>
<div class="text-gray-500 text-sm font-medium">Ju</div>
<div class="text-gray-500 text-sm font-medium">Vi</div>
<div class="text-gray-500 text-sm font-medium">Sa</div>
<div class="text-gray-500 text-sm font-medium">Do</div>
</div>
<div id="calendar-grid" class="grid grid-cols-7 gap-2 text-center">
<!-- Calendar days will be generated here -->
</div>
<div class="mt-6" id="time-slots-section">
<h4 class="font-semibold mb-3 text-text-light dark:text-text-dark">Horarios disponibles</h4>
<div id="selected-date-info" class="text-sm text-gray-600 dark:text-gray-400 mb-3"></div>
<div id="time-slots" class="grid grid-cols-3 sm:grid-cols-4 gap-2">
<!-- Time slots will be generated here -->
</div>
</div>
</div>
</div>
<div class="mb-8 hidden" id="step-3">
<h2 class="text-2xl font-semibold mb-4 text-text-light dark:text-text-dark"><span class="text-primary mr-3">4.</span>Sus datos</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="relative">
<span class="material-icons absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">person</span>
<input id="full-name" class="w-full pl-12 pr-4 py-3 border border-border-light dark:border-border-dark rounded-full bg-transparent focus:ring-primary focus:border-primary transition" placeholder="Nombre completo *" type="text" required/>
</div>
<div class="relative">
<span class="material-icons absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">email</span>
<input id="email" class="w-full pl-12 pr-4 py-3 border border-border-light dark:border-border-dark rounded-full bg-transparent focus:ring-primary focus:border-primary transition" placeholder="Correo electrónico *" type="email" required/>
</div>
<div class="relative md:col-span-2">
<span class="material-icons absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">phone</span>
<input id="phone" class="w-full pl-12 pr-4 py-3 border border-border-light dark:border-border-dark rounded-full bg-transparent focus:ring-primary focus:border-primary transition" placeholder="Número de teléfono *" type="tel" required/>
</div>
</div>
</div>
<div id="step-4" class="hidden">
<button class="w-full bg-primary text-white py-4 px-8 rounded-full font-semibold text-lg hover:bg-opacity-90 transition-all duration-300 transform hover:scale-105 flex items-center justify-center" onclick="showConfirmation(event)">
<span class="material-icons mr-2">event_available</span> Confirmar la cita
                  </button>
</div>
</div>
<div class="hidden text-center py-12" id="confirmation-message">
<div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
<span class="material-icons text-4xl text-green-500">check</span>
</div>
<h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-4">¡Cita confirmada!</h2>
<p class="text-lg text-gray-600 dark:text-gray-300 mb-2">Se ha enviado un correo de confirmación a su dirección.</p>
<p class="text-gray-500 dark:text-gray-400">Estaremos encantados de recibirle en el centro <strong>LaserOstop Valencia</strong> el <strong>15 de Octubre de 2025 a las 11:30</strong>.</p>
</div>

<!-- Payment Options Popup (Modal) -->
<div id="payment-popup" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
<div class="p-6 sm:p-8">
<!-- Header -->
<div class="text-center mb-6">
<div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
<span class="material-icons text-4xl text-primary">credit_card</span>
</div>
<h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">¿Sabías que puedes obtener un descuento?</h3>
<p class="text-gray-600 dark:text-gray-300">Elige cómo prefieres pagar tu sesión</p>
</div>

<!-- Payment Options -->
<div class="space-y-4">
<!-- Option 1: Pay at Center (Default - Already Selected) -->
<div class="border-2 border-primary bg-primary/5 rounded-xl p-6 relative">
<div class="absolute top-4 right-4">
<span class="bg-primary text-white text-xs font-bold px-3 py-1 rounded-full">SELECCIONADO</span>
</div>
<div class="flex items-start">
<span class="material-icons text-primary text-3xl mr-4">store</span>
<div class="flex-1">
<h4 class="font-bold text-lg text-gray-800 dark:text-white mb-1">Pagar en el centro</h4>
<p class="text-gray-600 dark:text-gray-300 text-sm mb-2">Paga el día de tu cita</p>
<div class="flex items-baseline">
<span id="popup-center-price" class="text-3xl font-bold text-primary">€190</span>
<span class="text-gray-500 ml-2 text-sm">Precio estándar</span>
</div>
</div>
</div>
</div>

<!-- Option 2: Pay Online Once (Discount) -->
<div class="border-2 border-gray-200 dark:border-gray-700 hover:border-primary rounded-xl p-6 cursor-pointer transition-all" onclick="selectPaymentOption(2)">
<div class="flex items-start">
<span class="material-icons text-purple-600 text-3xl mr-4">flash_on</span>
<div class="flex-1">
<div class="flex items-center mb-1">
<h4 class="font-bold text-lg text-gray-800 dark:text-white">Pagar online ahora</h4>
<span class="ml-2 bg-purple-100 text-purple-700 text-xs font-bold px-2 py-1 rounded">20€ DESCUENTO</span>
</div>
<p class="text-gray-600 dark:text-gray-300 text-sm mb-2">Pago único con descuento inmediato</p>
<div class="flex items-baseline">
<span id="popup-online-price" class="text-3xl font-bold text-purple-600">€170</span>
<span class="text-gray-400 line-through ml-2">€190</span>
<span class="text-green-600 ml-2 text-sm font-semibold">Ahorras €20</span>
</div>
<button class="mt-4 w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center">
<span class="material-icons mr-2">payment</span>
Pagar €<span id="popup-online-btn-price">170</span> ahora
</button>
</div>
</div>
</div>

<!-- Option 3: Pay in 3 Installments -->
<div class="border-2 border-gray-200 dark:border-gray-700 hover:border-primary rounded-xl p-6 cursor-pointer transition-all" onclick="selectPaymentOption(3)">
<div class="flex items-start">
<span class="material-icons text-blue-600 text-3xl mr-4">calendar_today</span>
<div class="flex-1">
<h4 class="font-bold text-lg text-gray-800 dark:text-white mb-1">Pagar en 3 cuotas mensuales</h4>
<p class="text-gray-600 dark:text-gray-300 text-sm mb-2">Facilita el pago dividiéndolo en 3 meses</p>
<div class="flex items-baseline mb-2">
<span class="text-2xl font-bold text-blue-600">3 ×</span>
<span id="popup-monthly-price" class="text-3xl font-bold text-blue-600 ml-2">€65</span>
<span class="text-gray-500 ml-2 text-sm">/mes</span>
</div>
<p class="text-gray-500 text-xs mb-4">Total: €<span id="popup-monthly-total">195</span></p>
<button class="mt-2 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center">
<span class="material-icons mr-2">schedule</span>
Pagar en 3 cuotas
</button>
</div>
</div>
</div>
</div>

<!-- Close Button -->
<div class="mt-6 text-center">
<button onclick="closePaymentPopup()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 font-medium">
Cerrar y continuar con pago en centro
</button>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>

<section class="bg-gray-50 dark:bg-gray-900/50 py-16 sm:py-24">
<div class="container mx-auto px-4 sm:px-6 lg:px-8">
<h2 class="text-3xl font-bold text-center mb-10 text-text-light dark:text-text-dark">Nuestros centros cerca de usted</h2>
<div id="spain-map-container" class="rounded-lg overflow-hidden shadow-xl">
<div id="spain-map"></div>
</div>
</div>
</section>

<!-- Google Reviews Section - Infinite Scroll Carousel -->
<section class="bg-white dark:bg-gray-800 py-16 sm:py-24 overflow-hidden">
<div class="max-w-7xl mx-auto">
<!-- Section Header -->
<div class="text-center mb-12 px-4 sm:px-6 lg:px-8">
<h2 class="text-3xl sm:text-4xl font-bold text-text-light dark:text-text-dark mb-4">Lo que dicen nuestros clientes</h2>
<p class="text-lg text-gray-600 dark:text-gray-400 mb-6">Más de 1,000 personas han dejado de fumar con LaserOstop</p>

<!-- Google Rating Aggregate -->
<div class="flex items-center justify-center gap-3 mb-2">
<img src="https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_92x30dp.png" alt="Google" class="h-6 opacity-80">
<div class="flex items-baseline gap-2">
<span class="text-4xl font-bold text-primary">4.8</span>
<div class="flex text-yellow-400 text-2xl">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
</div>
</div>
<p class="text-gray-500 dark:text-gray-400 text-sm">(1,234 reseñas verificadas)</p>
</div>

<!-- Carousel Row 1 - Scrolls Left -->
<div class="carousel-container carousel-row-1 mb-6">
<div class="carousel-track">
<!-- Original 6 reviews -->
<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Maria+Garcia&background=22A9AF&color=fff&size=48" alt="Maria Garcia" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">María García</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 2 semanas</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Increíble resultado. Después de 20 años fumando, por fin he conseguido dejarlo gracias a LaserOstop. El tratamiento fue indoloro y el personal muy profesional.
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Carlos+Rodriguez&background=843ed4&color=fff&size=48" alt="Carlos Rodriguez" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Carlos Rodríguez</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 1 mes</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Llevaba años intentando dejar de fumar sin éxito. Con LaserOstop lo conseguí en una sola sesión. Sin efectos secundarios, sin ansiedad.
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Laura+Martinez&background=f59e0b&color=fff&size=48" alt="Laura Martinez" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Laura Martínez</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 3 semanas</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
El mejor tratamiento para dejar de fumar. Rápido, efectivo y sin dolor. El equipo de Barcelona fue muy amable. Ya han pasado 2 meses sin fumar.
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Javier+Lopez&background=10b981&color=fff&size=48" alt="Javier Lopez" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Javier López</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 1 semana</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Sorprendente. No creía que funcionaría tan bien. Después de la sesión no he tenido ganas de fumar. El tratamiento con láser realmente funciona.
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Ana+Fernandez&background=ef4444&color=fff&size=48" alt="Ana Fernandez" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Ana Fernández</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 2 meses</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Excelente atención y resultados inmediatos. Dejé de fumar el mismo día del tratamiento y sin ningún esfuerzo. El centro de Madrid es muy profesional.
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Miguel+Santos&background=6366f1&color=fff&size=48" alt="Miguel Santos" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Miguel Santos</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 3 días</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Recomendado por un amigo y no me arrepiento. Proceso muy sencillo, sin dolor y sin efectos secundarios. Ya llevo 6 semanas sin fumar.
</p>
</article>

<!-- Duplicate for seamless loop -->
<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Maria+Garcia&background=22A9AF&color=fff&size=48" alt="Maria Garcia" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">María García</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 2 semanas</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Increíble resultado. Después de 20 años fumando, por fin he conseguido dejarlo gracias a LaserOstop. El tratamiento fue indoloro y el personal muy profesional.
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Carlos+Rodriguez&background=843ed4&color=fff&size=48" alt="Carlos Rodriguez" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Carlos Rodríguez</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 1 mes</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Llevaba años intentando dejar de fumar sin éxito. Con LaserOstop lo conseguí en una sola sesión. Sin efectos secundarios, sin ansiedad.
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Laura+Martinez&background=f59e0b&color=fff&size=48" alt="Laura Martinez" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Laura Martínez</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 3 semanas</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
El mejor tratamiento para dejar de fumar. Rápido, efectivo y sin dolor. El equipo de Barcelona fue muy amable. Ya han pasado 2 meses sin fumar.
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Javier+Lopez&background=10b981&color=fff&size=48" alt="Javier Lopez" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Javier López</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 1 semana</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Sorprendente. No creía que funcionaría tan bien. Después de la sesión no he tenido ganas de fumar. El tratamiento con láser realmente funciona.
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Ana+Fernandez&background=ef4444&color=fff&size=48" alt="Ana Fernandez" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Ana Fernández</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 2 meses</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Excelente atención y resultados inmediatos. Dejé de fumar el mismo día del tratamiento y sin ningún esfuerzo. El centro de Madrid es muy profesional.
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Miguel+Santos&background=6366f1&color=fff&size=48" alt="Miguel Santos" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Miguel Santos</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 3 días</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Recomendado por un amigo y no me arrepiento. Proceso muy sencillo, sin dolor y sin efectos secundarios. Ya llevo 6 semanas sin fumar.
</p>
</article>
</div>
</div>

<!-- Carousel Row 2 - Scrolls Right -->
<div class="carousel-container carousel-row-2">
<div class="carousel-track">
<!-- Different 6 reviews -->
<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Sofia+Ruiz&background=8b5cf6&color=fff&size=48" alt="Sofia Ruiz" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Sofía Ruiz</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 5 días</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Estoy muy contenta con el resultado. Fumaba desde hace 15 años y ahora puedo respirar mejor. El tratamiento fue rápido y efectivo. ¡Totalmente recomendable!
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=David+Moreno&background=ec4899&color=fff&size=48" alt="David Moreno" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">David Moreno</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 1 semana</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Lo mejor que he hecho por mi salud. El equipo de Valencia es excelente, muy atentos. Ya no fumo desde hace un mes y me siento increíble.
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Isabel+Torres&background=14b8a6&color=fff&size=48" alt="Isabel Torres" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Isabel Torres</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 2 semanas</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Impresionante. No sentí nada durante el tratamiento y desde entonces no he tenido ganas de fumar. Es como si nunca hubiera fumado. Muy agradecida.
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Pedro+Sanchez&background=f97316&color=fff&size=48" alt="Pedro Sanchez" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Pedro Sánchez</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 3 semanas</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Después de probar todos los métodos posibles, LaserOstop fue la solución. Personal muy profesional en Sevilla. Llevo 2 meses libre de tabaco.
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Carmen+Diaz&background=06b6d4&color=fff&size=48" alt="Carmen Diaz" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Carmen Díaz</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 4 días</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Mi marido y yo fuimos juntos y ambos dejamos de fumar. El tratamiento es cómodo, rápido y sin dolor. Ya llevamos 3 semanas sin fumar. ¡Funciona!
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Roberto+Gil&background=a855f7&color=fff&size=48" alt="Roberto Gil" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Roberto Gil</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 10 días</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Increíble método. Sin ansiedad, sin nerviosismo, sin ganas de fumar. El personal es muy amable y te explican todo detalladamente. Muy recomendable.
</p>
</article>

<!-- Duplicate for seamless loop -->
<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Sofia+Ruiz&background=8b5cf6&color=fff&size=48" alt="Sofia Ruiz" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Sofía Ruiz</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 5 días</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Estoy muy contenta con el resultado. Fumaba desde hace 15 años y ahora puedo respirar mejor. El tratamiento fue rápido y efectivo. ¡Totalmente recomendable!
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=David+Moreno&background=ec4899&color=fff&size=48" alt="David Moreno" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">David Moreno</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 1 semana</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Lo mejor que he hecho por mi salud. El equipo de Valencia es excelente, muy atentos. Ya no fumo desde hace un mes y me siento increíble.
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Isabel+Torres&background=14b8a6&color=fff&size=48" alt="Isabel Torres" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Isabel Torres</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 2 semanas</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Impresionante. No sentí nada durante el tratamiento y desde entonces no he tenido ganas de fumar. Es como si nunca hubiera fumado. Muy agradecida.
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Pedro+Sanchez&background=f97316&color=fff&size=48" alt="Pedro Sanchez" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Pedro Sánchez</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 3 semanas</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Después de probar todos los métodos posibles, LaserOstop fue la solución. Personal muy profesional en Sevilla. Llevo 2 meses libre de tabaco.
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Carmen+Diaz&background=06b6d4&color=fff&size=48" alt="Carmen Diaz" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Carmen Díaz</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 4 días</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Mi marido y yo fuimos juntos y ambos dejamos de fumar. El tratamiento es cómodo, rápido y sin dolor. Ya llevamos 3 semanas sin fumar. ¡Funciona!
</p>
</article>

<article class="review-card-carousel bg-gray-50 dark:bg-gray-700/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-600 hover:shadow-xl transition-shadow">
<div class="flex items-start gap-4 mb-4">
<img src="https://ui-avatars.com/api/?name=Roberto+Gil&background=a855f7&color=fff&size=48" alt="Roberto Gil" class="w-12 h-12 rounded-full flex-shrink-0">
<div class="flex-1 min-w-0">
<h3 class="font-semibold text-text-light dark:text-text-dark">Roberto Gil</h3>
<div class="flex items-center gap-2 mt-1">
<div class="flex text-yellow-400 text-sm">
<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
</div>
<span class="text-xs text-gray-500 dark:text-gray-400">Hace 10 días</span>
</div>
</div>
</div>
<p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
Increíble método. Sin ansiedad, sin nerviosismo, sin ganas de fumar. El personal es muy amable y te explican todo detalladamente. Muy recomendable.
</p>
</article>
</div>
</div>

<!-- See All Reviews Link -->
<div class="text-center mt-12 px-4 sm:px-6 lg:px-8">
<a href="https://search.google.com/local/reviews?placeid=ChIJa1xA0X7dYA0RqN0Xh6YKQOY" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 text-primary hover:text-primary/80 font-semibold text-lg transition-colors group">
Ver todas las reseñas en Google
<span class="material-icons transform group-hover:translate-x-1 transition-transform">arrow_forward</span>
</a>
</div>

<!-- Google Attribution (Required for Compliance) -->
<div class="text-center mt-6 px-4 sm:px-6 lg:px-8">
<p class="text-xs text-gray-400 dark:text-gray-500">Reseñas proporcionadas por Google</p>
</div>
</div>
</section>

</main>

<!-- WhatsApp Floating Button -->
<a href="https://wa.me/34689560130" target="_blank" rel="noopener noreferrer" class="fixed bottom-6 right-6 z-50 bg-green-500 hover:bg-green-600 text-white rounded-full p-4 shadow-2xl transition-all duration-300 transform hover:scale-110 flex items-center justify-center group" aria-label="Contactar por WhatsApp">
  <!-- WhatsApp Icon (SVG) -->
  <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
  </svg>
  <!-- Tooltip on hover -->
  <span class="absolute right-full mr-3 bg-gray-800 text-white text-sm font-medium px-3 py-2 rounded-lg whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none">
    ¿Necesitas ayuda? Chatea con nosotros
  </span>
</a>

</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<script>
    // Centers data with real GPS coordinates
    const centers = {
      'alicante': {
        lat: 38.3452, lng: -0.4810,
        name: 'LaserOstop Alicante',
        address: 'Calle Teniente Llorca 4, Bajo, 03001, Alicante',
        hours: '10:00 - 19:00',
        phone: '+34 613 255 948'
      },
      'barcelona-gracia': {
        lat: 41.4036, lng: 2.1570,
        name: 'LaserOstop Barcelona Gràcia',
        address: 'Carrer de Milton, 2, Gràcia, 08012, Barcelona',
        hours: '08:00 - 20:00',
        phone: '+34 605 592 509'
      },
      'barcelona-sants': {
        lat: 41.3784, lng: 2.1366,
        name: 'LaserOstop Barcelona Sants',
        address: 'Carrer de Galileu, 65, Sants-Montjuïc, 08028, Barcelona',
        hours: '08:00 - 18:00',
        phone: '+34 689 560 130'
      },
      'madrid-atocha': {
        lat: 40.3940, lng: -3.6835,
        name: 'LaserOstop Madrid Atocha',
        address: 'Calle Canarias 26, Atocha, 28045, Madrid',
        hours: '10:00 - 19:00',
        phone: '+34 613 255 948'
      },
      'madrid-chamartin': {
        lat: 40.4640, lng: -3.6783,
        name: 'LaserOstop Madrid Chamartín',
        address: 'Calle de Oruro, 9, Chamartín, 28016, Madrid',
        hours: '09:00 - 16:00',
        phone: '+34 919 305 313'
      },
      'majadahonda': {
        lat: 40.4732, lng: -3.8714,
        name: 'LaserOstop Majadahonda',
        address: 'Calle del Dr Calero, 19, Centro comercial Tutti, 28220, Majadahonda',
        hours: '09:00 - 16:00',
        phone: '+34 919 305 313'
      },
      'san-sebastian': {
        lat: 40.5485, lng: -3.6295,
        name: 'LaserOstop San Sebastián de los Reyes',
        address: 'Avenida de Murcia, 5, 28702, San Sebastián de los Reyes',
        hours: '09:00 - 16:00',
        phone: '+34 919 305 313'
      },
      'terrassa': {
        lat: 41.5633, lng: 2.0096,
        name: 'LaserOstop Terrassa',
        address: 'Calle Jaume Cantarer, 3, Local B, 08221, Terrassa',
        hours: '08:00 - 20:00',
        phone: '+34 605 592 509'
      },
      'torrejon': {
        lat: 40.4578, lng: -3.4763,
        name: 'LaserOstop Torrejón de Ardoz',
        address: 'Calle pesquera, 10, 28850, Torrejón de Ardoz',
        hours: '09:00 - 16:00',
        phone: '+34 919 305 313'
      },
      'valencia': {
        lat: 39.4699, lng: -0.3763,
        name: 'LaserOstop Valencia',
        address: 'Calle San Vicente Mártir 85 planta 7, 46007, Valencia',
        hours: '09:00 - 18:00',
        phone: '+34 689 560 130'
      },
      'sevilla': {
        lat: 37.3891, lng: -5.9845,
        name: 'LaserOstop Sevilla',
        address: 'Avenida Edouardo Dato 85, 41005, Sevilla',
        hours: '09:00 - 19:00',
        phone: '+34 689 560 130'
      }
    };

    let map;

    // Initialize Leaflet map
    function initializeMap() {
      // Create map centered on Spain
      map = L.map('spain-map').setView([40.4168, -3.7038], 6);

      // Add OpenStreetMap tiles (free, no API key needed)
      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 19,
        minZoom: 5
      }).addTo(map);

      // Custom marker icon
      const customIcon = L.divIcon({
        className: 'custom-marker',
        iconSize: [30, 30],
        iconAnchor: [15, 30],
        popupAnchor: [0, -30]
      });

      // Add markers for each center
      Object.keys(centers).forEach(centerId => {
        const center = centers[centerId];

        const marker = L.marker([center.lat, center.lng], { icon: customIcon })
          .addTo(map);

        // Create popup content
        const popupContent = `
          <div style="min-width: 200px;">
            <h3 style="font-size: 16px; margin-bottom: 8px;">${center.name}</h3>
            <p style="font-size: 13px; color: #666; margin-bottom: 4px;">
              <span style="display: inline-block; width: 18px;">📍</span> ${center.address}
            </p>
            <p style="font-size: 13px; color: #666; margin-bottom: 4px;">
              <span style="display: inline-block; width: 18px;">⏰</span> ${center.hours}
            </p>
            <p style="font-size: 13px; color: #666; margin-bottom: 8px;">
              <span style="display: inline-block; width: 18px;">📞</span> ${center.phone}
            </p>
            <button onclick="selectCenter('${centerId}')"
                    style="background: #22A9AF; color: white; padding: 8px 16px; border: none; border-radius: 20px; cursor: pointer; font-size: 13px; font-weight: 500; width: 100%;">
              Seleccionar este centro
            </button>
          </div>
        `;

        marker.bindPopup(popupContent);

        // Open popup on marker click
        marker.on('click', function() {
          map.setView([center.lat, center.lng], 12);
        });
      });
    }

    // Select center function
    function selectCenter(centerId) {
      const select = document.getElementById('center-select');
      select.value = centerId;
      select.dispatchEvent(new Event('change'));

      // Close any open popups
      map.closePopup();

      // Scroll to booking form
      document.getElementById('booking').scrollIntoView({ behavior: 'smooth' });
    }

    // Validation and confirmation function
    async function showConfirmation(event) {
      // Prevent default if called from button
      if (event) event.preventDefault();

      // Get form inputs
      const fullName = document.getElementById('full-name').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();

      // Validation errors array
      const errors = [];

      // Validate center selection
      if (!bookingState.selectedCenter) {
        errors.push('Por favor, seleccione un centro');
      }

      // Validate booking type selection
      if (!bookingState.selectedAppointmentType) {
        errors.push('Por favor, seleccione el tipo de sesión');
      }

      // Validate date selection
      if (!bookingState.selectedDate) {
        errors.push('Por favor, seleccione una fecha');
      }

      // Validate time selection
      if (!bookingState.selectedTime) {
        errors.push('Por favor, seleccione una hora');
      }

      // Validate full name
      if (!fullName || fullName.length < 3) {
        errors.push('Por favor, ingrese su nombre completo');
      }

      // Validate email
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!email || !emailRegex.test(email)) {
        errors.push('Por favor, ingrese un correo electrónico válido');
      }

      // Validate phone
      const phoneRegex = /^[+]?[\d\s()-]{9,}$/;
      if (!phone || !phoneRegex.test(phone)) {
        errors.push('Por favor, ingrese un número de teléfono válido');
      }

      // Show errors or proceed
      if (errors.length > 0) {
        alert('Por favor, complete todos los campos requeridos:\n\n' + errors.join('\n'));
        return;
      }

      // Store user data in booking state
      bookingState.fullName = fullName;
      bookingState.email = email;
      bookingState.phone = phone;

      console.log('Final booking data:', bookingState);

      // Get button reference
      const confirmBtn = event?.target || document.querySelector('button[onclick*="showConfirmation"]');

      // Submit booking to Smart Agenda API
      try {
        // Show loading state
        const originalText = confirmBtn.innerHTML;
        confirmBtn.disabled = true;
        confirmBtn.innerHTML = '<span class="material-icons animate-spin mr-2">sync</span> Procesando...';

        const result = await submitBooking();

        console.log('Booking created successfully:', result);

        // Update confirmation message with actual data
        const centerName = bookingState.smartAgendaCenters.find(c => c.id === bookingState.selectedCenter)?.name || 'nuestro centro';
        const dateStr = `${bookingState.selectedDate.getDate()} de ${monthNames[bookingState.selectedDate.getMonth()]} de ${bookingState.selectedDate.getFullYear()}`;

        document.querySelector('#confirmation-message p:last-child').innerHTML =
          `Estaremos encantados de recibirle en el centro <strong>${centerName}</strong> el <strong>${dateStr} a las ${bookingState.selectedTime}</strong>.`;

        // Show confirmation
        document.getElementById('booking-form').classList.add('hidden');
        document.getElementById('confirmation-message').classList.remove('hidden');

        // Show payment options popup after 2 seconds
        setTimeout(() => {
          showPaymentPopup();
        }, 2000);

      } catch (error) {
        console.error('Booking error:', error);
        alert('Error al crear la reserva: ' + error.message + '\n\nPor favor, inténtelo de nuevo o contáctenos directamente.');

        // Restore button
        if (confirmBtn) {
          confirmBtn.disabled = false;
          confirmBtn.innerHTML = '<span class="material-icons mr-2">event_available</span> Confirmar la cita';
        }
      }
    }

    /**
     * Show payment options popup
     */
    function showPaymentPopup() {
      // Get selected appointment type to determine pricing
      const selectedType = bookingState.appointmentTypes.find(t => t.id === bookingState.selectedAppointmentType);

      if (!selectedType) {
        console.warn('No appointment type found for payment popup');
        return;
      }

      // Calculate prices based on appointment type
      let centerPrice, onlinePrice, monthlyPrice, monthlyTotal;

      // Determine pricing based on type name
      const typeName = selectedType.name.toLowerCase();

      if (typeName.includes('duo')) {
        // DUO Cigarettes: 2×€170 center, 2×€160 online, 3×€114 monthly
        centerPrice = 170; // per person (total €340)
        onlinePrice = 160; // per person (total €320)
        monthlyPrice = 114;
        monthlyTotal = monthlyPrice * 3;
      } else if (typeName.includes('cannabis')) {
        // Cannabis: €250 center, €230 online, 3×€84 monthly
        centerPrice = 250;
        onlinePrice = 230;
        monthlyPrice = 84;
        monthlyTotal = monthlyPrice * 3;
      } else {
        // Cigarettes SOLO (default): €190 center, €170 online, 3×€65 monthly
        centerPrice = 190;
        onlinePrice = 170;
        monthlyPrice = 65;
        monthlyTotal = monthlyPrice * 3;
      }

      // Update popup prices
      document.getElementById('popup-center-price').textContent = `€${centerPrice}`;
      document.getElementById('popup-online-price').textContent = `€${onlinePrice}`;
      document.getElementById('popup-online-btn-price').textContent = onlinePrice;
      document.getElementById('popup-monthly-price').textContent = `€${monthlyPrice}`;
      document.getElementById('popup-monthly-total').textContent = monthlyTotal;

      // Store prices in popup for payment selection
      window.paymentPopupData = {
        centerPrice,
        onlinePrice,
        monthlyPrice,
        monthlyTotal,
        appointmentType: selectedType
      };

      // Show popup
      document.getElementById('payment-popup').classList.remove('hidden');
    }

    /**
     * Close payment popup
     */
    function closePaymentPopup() {
      document.getElementById('payment-popup').classList.add('hidden');
    }

    /**
     * Select payment option
     */
    function selectPaymentOption(option) {
      const data = window.paymentPopupData;

      if (!data) {
        console.error('Payment popup data not available');
        return;
      }

      if (option === 1) {
        // Pay at center (already selected)
        closePaymentPopup();
      } else if (option === 2) {
        // Pay online once
        alert(`Redirigiendo a Stripe para pagar €${data.onlinePrice}...\n\nNOTA: La integración de Stripe se completará cuando se configuren los enlaces de pago en Smart Agenda.`);
        // TODO: Redirect to Stripe Payment Link
        // window.location.href = stripePaymentLink;
      } else if (option === 3) {
        // Pay in 3 installments
        alert(`Redirigiendo a Stripe para pagar 3×€${data.monthlyPrice}/mes...\n\nNOTA: La integración de Stripe se completará cuando se configuren los enlaces de suscripción en Smart Agenda.`);
        // TODO: Redirect to Stripe Subscription Link
        // window.location.href = stripeSubscriptionLink;
      }
    }

    // ========== CALENDAR AND BOOKING LOGIC ==========

    // API Configuration - automatically detects environment
    const API_BASE_URL = window.location.hostname === 'localhost'
      ? 'http://localhost:3000/api'
      : 'https://laserostop-backend.onrender.com/api';

    // Booking state
    let bookingState = {
      selectedCenter: null,
      selectedDate: null,
      selectedTime: null,
      currentMonth: new Date(),
      availableSlots: {}, // Will be populated from Smart Agenda API
      smartAgendaCenters: [], // Centers from Smart Agenda
      appointmentTypes: [] // Appointment types for selected center
    };

    // Month names in Spanish
    const monthNames = [
      'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
      'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
    ];

    // Day names in Spanish
    const dayNames = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];

    // ========== API FUNCTIONS ==========

    /**
     * Load centers from Smart Agenda API
     */
    async function loadCentersFromAPI() {
      try {
        console.log('Loading centers from Smart Agenda...');
        const response = await fetch(`${API_BASE_URL}/centers`);

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const centers = await response.json();
        bookingState.smartAgendaCenters = centers;

        console.log('Loaded', centers.length, 'centers from Smart Agenda');

        // Populate the center dropdown
        populateCenterDropdown(centers);

        return centers;
      } catch (error) {
        console.error('Error loading centers:', error);
        alert('Error al cargar los centros. Por favor, recargue la página.');
        return [];
      }
    }

    /**
     * Populate center dropdown with API data
     */
    function populateCenterDropdown(centers) {
      const select = document.getElementById('center-select');

      // Clear existing options except the first one
      select.innerHTML = '<option value="">Seleccione un centro...</option>';

      // Add centers from API
      centers.forEach(center => {
        const option = document.createElement('option');
        option.value = center.id;
        option.textContent = center.name;
        select.appendChild(option);
      });
    }

    /**
     * Load appointment types for selected center
     */
    async function loadAppointmentTypes(centerId) {
      try {
        console.log('Loading appointment types for center:', centerId);
        const response = await fetch(`${API_BASE_URL}/appointment-types?centerId=${centerId}`);

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const types = await response.json();
        bookingState.appointmentTypes = types;

        console.log('Loaded', types.length, 'appointment types');

        // Warn if no appointment types available
        if (types.length === 0) {
          console.warn('⚠️ No appointment types available for this center');
          const centerName = bookingState.smartAgendaCenters.find(c => c.id === centerId)?.name;
          alert(`⚠️ Atención:\n\nEl centro "${centerName}" no tiene citas disponibles a través de este formulario.\n\nPor favor:\n- Seleccione otro centro\n- O use el enlace de reserva directo del centro haciendo clic en la tarjeta del centro en el mapa.`);
        }

        // Auto-select the first type if available
        if (types.length > 0) {
          bookingState.selectedAppointmentType = types[0].id;
        }

        return types;
      } catch (error) {
        console.error('Error loading appointment types:', error);
        return [];
      }
    }

    /**
     * Load availability for selected date range
     */
    async function loadAvailability(startDate, endDate) {
      if (!bookingState.selectedCenter || !bookingState.selectedAppointmentType) {
        console.log('Center or appointment type not selected');
        return {};
      }

      try {
        console.log('Loading availability from', startDate, 'to', endDate);

        const params = new URLSearchParams({
          centerId: bookingState.selectedCenter,
          typeId: bookingState.selectedAppointmentType,
          startDate: formatDateForAPI(startDate),
          endDate: formatDateForAPI(endDate)
        });

        const response = await fetch(`${API_BASE_URL}/availability?${params.toString()}`);

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const availability = await response.json();
        console.log('Availability data:', availability);

        // Process availability data into our format
        bookingState.availableSlots = processAvailabilityData(availability);

        return bookingState.availableSlots;
      } catch (error) {
        console.error('Error loading availability:', error);
        return {};
      }
    }

    /**
     * Process availability data from API into time slots format
     */
    function processAvailabilityData(apiData) {
      // TODO: Parse Smart Agenda availability format
      // For now, return sample data structure
      // This will be updated once we test the actual API response format

      const slots = {};

      // Example: if apiData has array of available times
      // apiData.forEach(slot => {
      //   const dateKey = slot.date;
      //   if (!slots[dateKey]) slots[dateKey] = {};
      //   slots[dateKey][slot.time] = true;
      // });

      return slots;
    }

    /**
     * Format date for API (YYYY-MM-DD)
     */
    function formatDateForAPI(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    /**
     * Format datetime for API (YYYY-MM-DD HH:MM:SS)
     */
    function formatDateTimeForAPI(date, time) {
      return `${formatDateForAPI(date)} ${time}:00`;
    }

    /**
     * Submit booking to Smart Agenda
     */
    async function submitBooking() {
      try {
        console.log('Submitting booking to Smart Agenda...');

        // Calculate end time (assuming 30 min appointment)
        const startDateTime = formatDateTimeForAPI(bookingState.selectedDate, bookingState.selectedTime);
        const endTime = bookingState.selectedTime.split(':');
        const endHour = parseInt(endTime[0]);
        let endMin = parseInt(endTime[1]) + 30;
        let finalEndHour = endHour;

        // Handle minute overflow
        if (endMin >= 60) {
          finalEndHour = endHour + 1;
          endMin = endMin - 60;
        }

        const endDateTime = formatDateTimeForAPI(
          bookingState.selectedDate,
          `${String(finalEndHour).padStart(2, '0')}:${String(endMin).padStart(2, '0')}`
        );

        // Use appointment type from loaded types
        let typeId = bookingState.selectedAppointmentType;

        // If no appointment type is selected, try to use the first available one
        if (!typeId && bookingState.appointmentTypes && bookingState.appointmentTypes.length > 0) {
          typeId = bookingState.appointmentTypes[0].id;
          console.log('Auto-selected first appointment type:', typeId);
        }

        // If still no appointment type, this center doesn't have any configured
        if (!typeId) {
          throw new Error('Este centro no tiene tipos de cita configurados. Por favor, seleccione otro centro o use el enlace de reserva directo del centro.');
        }

        // Detect URL source for tracking
        const urlPath = window.location.pathname;
        const urlSlug = urlPath.split('/').filter(p => p)[0];
        const source = urlSlug || 'direct';

        const bookingData = {
          fullName: bookingState.fullName,
          email: bookingState.email,
          phone: bookingState.phone,
          centerId: bookingState.selectedCenter,
          typeId: typeId,
          startTime: startDateTime,
          endTime: endDateTime,
          source: source // Track where booking came from
        };

        console.log('Booking data:', bookingData);

        const response = await fetch(`${API_BASE_URL}/booking`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(bookingData)
        });

        if (!response.ok) {
          const errorData = await response.json();
          console.error('Backend error response:', errorData);
          throw new Error(errorData.details || errorData.message || errorData.error || 'Booking failed');
        }

        const result = await response.json();
        console.log('✅ Booking successful:', result);

        return result;
      } catch (error) {
        console.error('❌ Error submitting booking:', error);
        throw error;
      }
    }

    // Sample time slots (fallback for when API doesn't return data)
    const sampleTimeSlots = {
      '09:00': true,
      '09:30': true,
      '10:00': true,
      '10:30': false, // unavailable
      '11:00': true,
      '11:30': true,
      '12:00': false, // unavailable
      '14:00': true,
      '14:30': true,
      '15:00': true,
      '15:30': true,
      '16:00': true,
      '16:30': false, // unavailable
      '17:00': true,
      '17:30': true,
      '18:00': true
    };

    // Generate calendar for current month
    function generateCalendar() {
      const year = bookingState.currentMonth.getFullYear();
      const month = bookingState.currentMonth.getMonth();

      // Update month display
      document.getElementById('current-month').textContent =
        `${monthNames[month]} ${year}`;

      // Get first day of month and number of days
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const daysInMonth = lastDay.getDate();

      // Get day of week for first day (0 = Sunday, adjust to Monday = 0)
      let startDay = firstDay.getDay() - 1;
      if (startDay === -1) startDay = 6; // Sunday becomes 6

      // Get today's date for comparison
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      const calendarGrid = document.getElementById('calendar-grid');
      calendarGrid.innerHTML = '';

      // Add empty cells for days before month starts
      for (let i = 0; i < startDay; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'text-gray-400 text-sm';
        calendarGrid.appendChild(emptyCell);
      }

      // Add days of the month
      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(year, month, day);
        const dayCell = document.createElement('div');

        const isPast = date < today;
        const isSelected = bookingState.selectedDate &&
          date.toDateString() === bookingState.selectedDate.toDateString();
        const isToday = date.toDateString() === today.toDateString();

        // Base classes
        let classes = 'text-sm py-2 rounded-full transition-all';

        if (isPast) {
          // Past dates - disabled
          classes += ' text-gray-400 cursor-not-allowed';
        } else if (isSelected) {
          // Selected date
          classes += ' bg-primary text-white cursor-pointer font-semibold transform scale-110';
        } else if (isToday) {
          // Today
          classes += ' bg-primary/20 border-2 border-primary text-primary cursor-pointer font-semibold hover:bg-primary/30';
        } else {
          // Future dates - selectable
          classes += ' hover:bg-gray-200 dark:hover:bg-gray-600 cursor-pointer';
        }

        dayCell.className = classes;
        dayCell.textContent = day;

        // Add click handler for future dates
        if (!isPast) {
          dayCell.onclick = () => selectDate(date);
        }

        calendarGrid.appendChild(dayCell);
      }
    }

    // Select a date
    function selectDate(date) {
      bookingState.selectedDate = date;
      bookingState.selectedTime = null; // Reset time selection

      generateCalendar(); // Refresh calendar to show selection
      generateTimeSlots(); // Show available time slots
      updateStepIndicators(); // Update visual indicators
    }

    // Generate time slots for selected date
    function generateTimeSlots() {
      const timeSlotsContainer = document.getElementById('time-slots');
      const dateInfo = document.getElementById('selected-date-info');

      if (!bookingState.selectedDate) {
        timeSlotsContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400 col-span-full text-center py-4">Seleccione una fecha para ver los horarios disponibles</p>';
        dateInfo.textContent = '';
        return;
      }

      // Show selected date
      const dayName = dayNames[bookingState.selectedDate.getDay()];
      const day = bookingState.selectedDate.getDate();
      const month = monthNames[bookingState.selectedDate.getMonth()];
      const year = bookingState.selectedDate.getFullYear();
      dateInfo.textContent = `Horarios para ${dayName}, ${day} de ${month} de ${year}`;

      // Generate time slot buttons
      timeSlotsContainer.innerHTML = '';

      Object.keys(sampleTimeSlots).forEach(time => {
        const available = sampleTimeSlots[time];
        const button = document.createElement('button');

        const isSelected = bookingState.selectedTime === time;

        if (isSelected) {
          button.className = 'py-2 px-3 bg-primary text-white rounded-full border border-primary font-semibold';
        } else if (available) {
          button.className = 'py-2 px-3 border border-border-light dark:border-border-dark rounded-full hover:border-primary hover:text-primary transition';
          button.onclick = () => selectTime(time);
        } else {
          button.className = 'py-2 px-3 border border-border-light dark:border-border-dark rounded-full text-gray-400 cursor-not-allowed opacity-50';
          button.disabled = true;
        }

        button.textContent = time;
        timeSlotsContainer.appendChild(button);
      });
    }

    // Select a time slot
    function selectTime(time) {
      bookingState.selectedTime = time;
      generateTimeSlots(); // Refresh to show selection
      updateStepIndicators(); // Update visual indicators

      console.log('Booking state:', bookingState);
      // This will be used later for Smart Agenda API call
    }

    // Navigate to previous month
    document.getElementById('prev-month').addEventListener('click', () => {
      bookingState.currentMonth.setMonth(bookingState.currentMonth.getMonth() - 1);
      generateCalendar();
    });

    // Navigate to next month
    document.getElementById('next-month').addEventListener('click', () => {
      bookingState.currentMonth.setMonth(bookingState.currentMonth.getMonth() + 1);
      generateCalendar();
    });

    // Update booking state when center is selected
    document.getElementById('center-select').addEventListener('change', async (e) => {
      bookingState.selectedCenter = e.target.value;
      console.log('Selected center:', bookingState.selectedCenter);

      // Show visual feedback
      updateStepIndicators();

      // Reset selection
      bookingState.selectedDate = null;
      bookingState.selectedTime = null;
      bookingState.selectedAppointmentType = null;

      if (bookingState.selectedCenter) {
        // Load appointment types for this center
        await loadAppointmentTypes(bookingState.selectedCenter);

        // Show booking type selector and populate it
        populateBookingTypeDropdown(bookingState.appointmentTypes);

        // Load availability for current month
        const startDate = new Date(bookingState.currentMonth.getFullYear(), bookingState.currentMonth.getMonth(), 1);
        const endDate = new Date(bookingState.currentMonth.getFullYear(), bookingState.currentMonth.getMonth() + 1, 0);
        await loadAvailability(startDate, endDate);
      } else {
        // Hide booking type selector if no center selected
        document.getElementById('step-1b').classList.add('hidden');
        document.getElementById('step-2').classList.add('hidden');
        document.getElementById('step-3').classList.add('hidden');
        document.getElementById('step-4').classList.add('hidden');
      }

      generateCalendar();
      generateTimeSlots();
    });

    /**
     * Strip HTML tags from text
     */
    function stripHTML(html) {
      const tmp = document.createElement('div');
      tmp.innerHTML = html;
      return tmp.textContent || tmp.innerText || '';
    }

    // Populate booking type dropdown
    function populateBookingTypeDropdown(types) {
      const select = document.getElementById('booking-type-select');
      const step1b = document.getElementById('step-1b');

      // Clear existing options except the first one
      select.innerHTML = '<option value="">Seleccione el tipo de sesión...</option>';

      if (types && types.length > 0) {
        // Filter: Only show "pay at center" types (deposit = 0 or price = deposit means full prepay)
        // Show types where deposit is 0 (pay at center)
        const centerPaymentTypes = types.filter(type =>
          type.deposit === 0 && type.price > 0
        );

        if (centerPaymentTypes.length === 0) {
          console.warn('No "pay at center" appointment types available');
          step1b.classList.add('hidden');
          return;
        }

        // Add types to dropdown
        centerPaymentTypes.forEach(type => {
          const option = document.createElement('option');
          option.value = type.id;
          option.textContent = type.name;
          option.dataset.price = type.price || '190';
          option.dataset.duration = type.duration || '30';

          // Strip HTML from description
          const cleanDescription = stripHTML(type.description || '').trim();
          option.dataset.description = cleanDescription || 'Pago en el centro';

          select.appendChild(option);
        });

        // Show the booking type section
        step1b.classList.remove('hidden');
      } else {
        // Hide the booking type section if no types available
        step1b.classList.add('hidden');
      }
    }

    // Handle booking type selection
    document.getElementById('booking-type-select').addEventListener('change', (e) => {
      const selectedOption = e.target.options[e.target.selectedIndex];
      bookingState.selectedAppointmentType = e.target.value;

      const infoBox = document.getElementById('booking-type-info');
      const step2 = document.getElementById('step-2');
      const step3 = document.getElementById('step-3');
      const step4 = document.getElementById('step-4');

      if (bookingState.selectedAppointmentType) {
        // Show type details
        const duration = selectedOption.dataset.duration || '30';
        const price = selectedOption.dataset.price || '190';
        const description = selectedOption.dataset.description || '-';

        document.getElementById('type-duration').textContent = `${duration} minutos`;
        document.getElementById('type-price').textContent = `€${price}`;
        document.getElementById('type-description').textContent = description;

        infoBox.classList.remove('hidden');

        // Show next steps
        step2.classList.remove('hidden');
        step3.classList.remove('hidden');
        step4.classList.remove('hidden');

        // Update step indicators
        updateStepIndicators();

        console.log('Selected appointment type:', bookingState.selectedAppointmentType);
      } else {
        // Hide type details and next steps
        infoBox.classList.add('hidden');
        step2.classList.add('hidden');
        step3.classList.add('hidden');
        step4.classList.add('hidden');
      }
    });

    // Update step completion indicators
    function updateStepIndicators() {
      const step1 = document.querySelector('#step-1 h2');
      const step1b = document.querySelector('#step-1b h2');
      const step2 = document.querySelector('#step-2 h2');
      const step3 = document.querySelector('#step-3 h2');

      // Step 1: Center selected
      if (bookingState.selectedCenter) {
        if (!step1.querySelector('.material-icons.text-green-500')) {
          step1.innerHTML = '<span class="text-primary mr-3">1.</span>Elija su centro <span class="material-icons text-green-500 align-middle ml-2">check_circle</span>';
        }
      } else {
        step1.innerHTML = '<span class="text-primary mr-3">1.</span>Elija su centro';
      }

      // Step 1b (2): Booking type selected
      if (step1b) {
        if (bookingState.selectedAppointmentType) {
          if (!step1b.querySelector('.material-icons.text-green-500')) {
            step1b.innerHTML = '<span class="text-primary mr-3">2.</span>Tipo de sesión <span class="material-icons text-green-500 align-middle ml-2">check_circle</span>';
          }
        } else {
          step1b.innerHTML = '<span class="text-primary mr-3">2.</span>Tipo de sesión';
        }
      }

      // Step 2 (now 3): Date and time selected
      if (step2) {
        if (bookingState.selectedDate && bookingState.selectedTime) {
          if (!step2.querySelector('.material-icons.text-green-500')) {
            step2.innerHTML = '<span class="text-primary mr-3">3.</span>Elija una fecha y una hora <span class="material-icons text-green-500 align-middle ml-2">check_circle</span>';
          }
        } else {
          step2.innerHTML = '<span class="text-primary mr-3">3.</span>Elija una fecha y una hora';
        }
      }
    }

    // Initialize calendar on load
    function initializeCalendar() {
      generateCalendar();
      generateTimeSlots();
    }

    // URL slug to center ID mapping
    const CENTER_URL_MAPPING = {
      'barcelona-sants': '3',      // Barcelona Sants
      'valencia': '1',              // Valencia
      'madrid-atocha': '8',         // Madrid Atocha
      'madrid-chamartin': '7',      // Madrid Chamartín
      'sevilla': '5',               // Sevilla
      'majadahonda': '10',          // Majadahonda
      'san-sebastian': '9',         // San Sebastián de los Reyes
      'torrejon': '6'               // Torrejón de Ardoz
    };

    /**
     * Detect center from URL path
     */
    function getCenterFromURL() {
      const path = window.location.pathname;
      const slug = path.split('/').filter(p => p)[0]; // Get first path segment

      const centerId = CENTER_URL_MAPPING[slug];

      if (centerId) {
        console.log('📍 Detected center from URL:', slug, '→ Center ID:', centerId);
      }

      return centerId || null;
    }

    /**
     * Auto-select center if URL contains center slug
     */
    async function autoSelectCenterFromURL() {
      const centerId = getCenterFromURL();

      if (centerId) {
        // Wait for centers to be loaded
        if (bookingState.smartAgendaCenters.length === 0) {
          console.log('⏳ Waiting for centers to load before auto-selecting...');
          return centerId; // Return for later use
        }

        // Check if this center exists
        const centerExists = bookingState.smartAgendaCenters.find(c => c.id === centerId);

        if (centerExists) {
          console.log('✅ Auto-selecting center:', centerExists.name);

          // Set the dropdown value
          const select = document.getElementById('center-select');
          select.value = centerId;

          // Trigger the change event to load appointment types
          select.dispatchEvent(new Event('change'));

          // Scroll to booking section
          setTimeout(() => {
            document.getElementById('booking').scrollIntoView({ behavior: 'smooth' });
          }, 500);
        } else {
          console.warn('⚠️ Center ID from URL not found in Smart Agenda:', centerId);
        }
      }
    }

    // Initialize everything on load
    window.addEventListener('DOMContentLoaded', async () => {
      console.log('LaserOstop Booking System - Initializing...');

      // Initialize map
      initializeMap();

      // Initialize calendar
      initializeCalendar();

      // Load centers from Smart Agenda API
      await loadCentersFromAPI();

      // Auto-select center from URL if present
      await autoSelectCenterFromURL();

      console.log('Initialization complete!');
    });
  </script>

</body>
</html>
